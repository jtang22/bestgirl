<!DOCTYPE html>
<html ng-app="submitExample">
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


		<script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore-min.js"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/underscore.string/2.3.3/underscore.string.min.js"></script>
		<script src="//code.jquery.com/jquery-2.1.1.min.js"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/path.js/0.8.4/path.min.js"></script>		
		<script src="//www.parsecdn.com/js/parse-1.2.19.min.js"></script>		
		<script src="//cdn.rawgit.com/Artod/baascms/master/dist/baascms-1.0.0.min.js"></script>
		<script src="//cdn.rawgit.com/Artod/baascms/master/dist/baascms-adapter-parse-1.0.0.min.js"></script>
    		<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.5/angular.min.js"></script>
    		
    		<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

		<!-- jQuery library -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

		<!-- Latest compiled JavaScript -->
		<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    		
    		<script>
			Parse.initialize('CIm8WurcJWCQVTYw987q9CerkhCMDUbNHLhqvStQ', 'ac8h6anPfJqtr9wYpkC8vGrUZ7Gmgn0CGeqPPAoJ');
			
			BaasCMS.init({
				baas: 'Parse'
			});
			
			
		</script>
		<script>
    angular.module('submitExample', [])
    .controller('ExampleController', ['$scope', function($scope) {
      $scope.girlList = [];
      $scope.firstGirl;
      $scope.secondGirl;
      $scope.tabs = [1,0,0,0,0];
     
      $scope.getGirls = function(){
	      var Girl = Parse.Object.extend("Girl");
	      var query = new Parse.Query(Girl);
	      query.find({
  	      success: function(results) {
		        $scope.girlList = [];
		          for (var i = 0; i < results.length; i++) {
			        $scope.girlList.push({firstName:results[i].get("firstName"),
			        lastName:results[i].get("lastName"),
			        series:results[i].get("series"),
			        image:results[i].get("image").url(),
			        score:results[i].get("score"),
			        total:results[i].get("total"),
			        wins:results[i].get("wins"),
			        losses:results[i].get("losses")})
			        $scope.pickGirls();
			        $scope.$apply();
		          }
		 
		        
  	      },
  	      error: function(error) {
	     }
	  });
      }
      $scope.pickGirls = function() {
      	var firstNdx = Math.floor(Math.random() * $scope.girlList.length);
      	var secondNdx = Math.floor(Math.random() * $scope.girlList.length);
        
	$scope.firstGirl = $scope.girlList[firstNdx];
	$scope.secondGirl = $scope.girlList[secondNdx];
	
      }
      $scope.left = function(){
//      	alert("picked left girl");
      	$scope.battle($scope.firstGirl,$scope.secondGirl);
      	$scope.pickGirls();
      }
      $scope.right = function(){
//	alert("picked right girl") ;  
	$scope.battle($scope.secondGirl,$scope.firstGirl);
	$scope.pickGirls();
      }
      $scope.battle = function(winner,loser){
      	
      	var winnerNewScore;
      	var winnerWins;
      	var winnerLosses;
      	var loserNewScore;
      	var loserWins;
      	var loserLosses;
      	
      	
      		var totalScoreWinner = winner.total + loser.score;
      		winner.wins += 1;
      		winnerNewScore= (totalScoreWinner + 400*(winner.wins - winner.losses)/(winner.wins + winner.losses));
		winnerWins = winner.wins;
		winnerLosses= winner.losses;
		
		var totalScoreLoser = loser.total + winner.score;
		loser.losses += 1;
		loserNewScore = (totalScoreLoser + 400 * (loser.wins - loser.losses)/(loser.wins + loser.losses));
		loserWins = loser.wins;
		loserLosses = loser.losses;
	   
      	
      	
      	
      	
      	var Girl = Parse.Object.extend("Girl");
      	var queryWinner = new Parse.Query(Girl);
      	var queryLoser = new Parse.Query(Girl);
      	queryWinner.equalTo("firstName", winner.firstName);
      	queryWinner.equalTo("lastName", winner.lastName);
      	queryLoser.equalTo("firstName", loser.firstName);
      	queryLoser.equalTo("lastName", loser.lastName);
      	queryWinner.find({
  	      success: function(results) {
		     results[0].set("score",winnerNewScore);
		     results[0].set("total",totalScoreWinner);
		     results[0].set("wins",winnerWins);
		     results[0].set("losses",winnerLosses);
		     results[0].save();
  	      },
  	      error: function(error) {
  	      	alert("Error");
	     }
      	});
      	queryLoser.find({
  	      success: function(results) {
		     results[0].set("score",loserNewScore);
		     results[0].set("total",totalScoreLoser);
		     results[0].set("wins",loserWins);
		     results[0].set("losses",loserLosses);
		     results[0].save();
  	      },
  	      error: function(error) {
  	      	alert("Error");
	     }
      	});
      	
      	
      }
      $scope.tabs = function(num){
      	
      	 for (var i = 0; i < $scope.tabs.length; i++) {
		$scope.tabs[i]= 0;      
	 }
	 $scope.tabs[num]=1;
      }
       $scope.addImage = function(){
      	
      	var Girl= Parse.Object.extend("Girl");
      	var girl = new Girl();
      	girl.set("firstName",$scope.firstName);
      	girl.set("lastName",$scope.lastName);
      	girl.set("series",$scope.series);
      	girl.set("score",500);
      	girl.set("total",0);
      	girl.set("wins",0);
      	girl.set("losses",0);
  		
  		
  		var imageUploadControl = $("#image")[0];
      		var parseImage;
      		$scope.imageName = $scope.image.slice(12);
      		if (imageUploadControl.files.length > 0) {
		  	var image = imageUploadControl.files[0];
   		 	var imageName = $scope.imageName;
   		 	parseImage = new Parse.File(imageName, image);
   		 	alert("Uploaded Image: " + parseImage);
      		}
  		girl.set("image",parseImage);
  		girl.save();
      	
  
      };
    }]);
    
</script>
</head>



<body >
	







<div ng-controller="ExampleController" data-ng-init = "getGirls()" >
	
	<div class="container">
	<div class="jumbotron">
  	<h1 class="text-center"> Best Girl </h2>
	</div>	
	</div>
	
	
	<div class="container">
  		<h2>Navigation Bar</h2>
		<ul class="nav nav-tabs">
    			<li class="active"><a data-toggle="tab" href="#home" ng-click="tabs(0)">Add a Girl</a></li>
		 	<li><a data-toggle="tab" href="#menu1" ng-click="tabs(1)">See Leaderboard</a></li>
    			<li><a data-toggle="tab" href="#menu2" ng-click="tabs(2)">Images</a></li>
  		</ul>


  		<div class="tab-content">
  	
      		
    		<div id="home" class="tab-pane fade in active">
      			<h3>Add a Book</h3>
      
		<div class="container" >
			
			
			
		<h3>Pick a Girl:</h3>
		
		<div class = "col-sm-6">
			<div class = "row-sm-3">
				<img ng-src="{{firstGirl.image}}"  style="height:128px;"/>	
				{{firstGirl.score}}
			</div>
			<div class = "row-sm-3">
				<input class="btn btn-primary" type="submit" id="left" ng-click="left()"/>	
			</div>
		</div>
		<div class = "col-sm-6">
			
			<div class = "row-sm-3">
				<img ng-src="{{secondGirl.image}}"   style="height:128px;"/>	
				{{secondGirl.score}}

			</div>
			<div class = "row-sm-3">
				<input class="btn btn-primary" type="submit" id="right" ng-click="right()"/>	
			</div>
		</div>
     
		</div>	 


   	 
 
		
      
      
    		</div>
    		
    		
    		<div id="menu1" class="tab-pane fade">
      			<h3>Add Words to a Book </h3>
 
	 		<div class="container">
  				<table id="myTable" class="table table-hover">
    				<tr>
    					<th>Photo</th>
      					<th>First Name</th>
      					<th>Last Name</th>
      					<th>Series</th>
      					<th>Score</th>
      					<th>Wins</th>
      					<th>Losses</th>
					 </tr>
    				<tr ng-repeat="girl in girlList">
    					<td>				
      						<img ng-src="{{girl.image}}"   style="height:128px;"/>	
					</td>
      					<td>{{girl.firstName}}</td>
      					<td>{{girl.lastName}}</td>
      					<td>{{girl.series}}</td>
      					<td>{{girl.score}}</td>
      					<td>{{girl.wins}}</td>
      					<td>{{girl.losses}}</td>
      					
			 		</tr>
  				</table>
		</div>
   	 
 

	 	</div>
	 		
	 	<div id="menu2" class="tab-pane fade">
      			<h3>Add Images to a Book</h3>
			<div class="container" >
      				<h3>First Name:</h3>
      				<input class="form-control"  type="text"  placeholder="Example: Kaname" ng-model="firstName" name="name2" />
      				<h3>Last Name:</h3>
      				<input class="form-control"  type="text"  placeholder="Example: Chidori" ng-model="lastName" />
    				<h3>Series:</h3>
      				<input class="form-control"  type="text"  placeholder="Example: Full Metal Panic" ng-model="series"/>
      			
      				<h3>Image:</h3>
      				<input type="file" id="image" ng-model="image"/>

      				<p></p>
      				<input class="btn btn-primary btn-block" type="submit" id="addImage" value="Submit" ng-click="addImage()" />
      			
      

		</div >
		
		</div>

			
      				
      				
    		</div>
    
   	</div>

		
	

      		
      	</div>
      		









</body>
</html>
